{% extends 'agora/base_template.html' %}

{% block title %}
    {{ current_topic.name }}
{% endblock %}


{% block body_block %}

    <h1>{{ current_topic.name }}</h1>

<p>sort method: {{ sort_method }} (
    <a href="/agora/topics/{{ current_topic.id }}/sort/liquid_value/">liquid_value</a>
    <a href="/agora/topics/{{ current_topic.id }}/sort/direct_value/">direct_value</a>
    <a href="/agora/topics/{{ current_topic.id }}/sort/created_at/">created_at</a>
    )</p>

    {% if user.is_authenticated %}
        {% if sub %}
            <p>Subscribed! (<a href="/agora/topics/{{ current_topic.id }}/subs/">unsub</a>)  </p>
        {% else %}
            <p>(<a href="/agora/topics/{{ current_topic.id }}/subs/">Subscribe?</a>)  </p>
        {% endif %}
        {% if rep %}
            Representitive: {{ rep.rep }}
        {% else %}
            No rep - pick one?
        {% endif %}
    {% endif %}
    <a href="/agora/topics/{{ current_topic.id }}/newrep">Pick Representative</a>
    <h3>Sub Topics</h3>

{% if topic_list %}
    <ul>
        {% for topic in topic_list %}
            <li><a href="/agora/topics/{{ topic.id }}/">{{ topic.name }}</a> {{ topic.subscription_set.all|length }}
            <br> author: {{ topic.author }} @ {{ topic.created_at }}
            <br> sub-topics: {{ topic.topic_set.all|length }} Posts {{ topic.post_set.all|length }}
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No sub-topics found...</p>
{% endif %}

    <a href="/agora/topics/new/{{ current_topic.id }}/">New Topic</a>

    <h3>Posts</h3>
    {% if current_topic.post_set.all %}
        <ul>
            {% for post in current_topic.post_set.all|dictsortreversed:sort_method %}
                <li><a href="/agora/topics/{{ current_topic.id }}/posts/{{ post.id }}">{{ post.name }}</a>
                <br><span> total: {{ post.liquid_value }}, direct: {{ post.direct_value }}, vote count: {{ post.postvote_set.all|length }} </span>
                <br><span> by: {{ post.author.username }} @ {{ post.created_at }}, with: {{ post.post_set.all|length }} comments </span>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p> no Posts Found </p>
    {% endif %}
    {% if current_topic %}
        <a href="/agora/topics/{{ current_topic.id }}/newpost/">New Post</a>
    {% endif %}
{% endblock %}
